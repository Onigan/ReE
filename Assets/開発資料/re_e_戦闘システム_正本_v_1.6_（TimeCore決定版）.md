# ReE 戦闘システム 正本 v1.6（TimeCore決定版）

- **作成日**：2026-01-10（JST）
- **作成者**：ノア（整理・正本化）
- **上書き宣言（Supersede Mark）**
  - 本書 v1.6 は `re_e_戦闘システム_正本_v_1.5.md` を **完全に置換**する。
  - 本書 v1.6 は NotebookLLM 整理メモ `戦闘根本原理：TimeCore（時間戦闘核）.txt` を **補強ソース**として取り込みつつ、**矛盾時は v1.5 の「確定事項」を優先**して整合させた“決定版”である。
- **確定ラベル**
  - **[確定]**：本書でα1.0として固定
  - **[補強]**：NotebookLLMメモ由来で、α1.0で採用するもの（本書で確定に昇格）
  - **[保留]**：将来拡張候補（α1.1+）

---

## 目次
0. 不変原則  
1. 戦闘UI（配置とRoot 5枠固定）  
2. TimeCore（時間戦闘核）  
3. 行動モデル（Schedule → Execute）  
4. ステータス体系（情報二層）  
5. 距離・空間・移動  
6. 攻撃処理（近接／遠距離）  
7. 防御仕様（最重要・確定）  
8. 疲労（Fatigue）  
9. 部位・ゾーン  
10. 状態異常（採用セット）  
11. 魔法・詠唱  
12. 戦闘ログ（二層構造）  
13. AIとナラティブ運用  
14. 禁止事項（事故防止）  
15. テストチェックリスト（α1.0）  
16. 更新履歴  

---

## 0. 不変原則（Hardcore + 時間距離）

- **[確定]** ReEの戦闘は「**時間（Time）**」と「**距離（Distance）**」で成立する。
- **[確定]** ターン制ではなく **TimeCore（μt管理）** によって順序決定される。
- **[確定]** 数値は内部で保持するが、プレイヤーUIには **極力出さない**（HP/MP/命中率/残り秒などを表示しない）。
- **[確定]** プレイヤーの勝敗は反射神経ではなく **事前選択と状況判断**（ログ読解・研究）で左右される。

---

## 1. 戦闘UI（配置とRoot 5枠固定）

### 1.1 CommonUI 配置（固定）
- **[確定]** 左：ActionBoard（OptionButton_0..4）＝**常に5枠**
- **[確定]** 中央〜上：BattleLog（スクロール）
- **[確定]** 下：FreeInput（自由記述）
- **[確定]** Back（戻る）は **ActionBoard 5枠に置かない**  
  - 戻る操作は **Esc / B（Cancel）** を正式とする  
  - 画面内にBackButtonを置く場合は「ActionBoard外（BackArea）」で、Esc/Bと同一動作にする

### 1.2 Root（5枠固定）
- **[確定]** Rootの5枠は以下で固定する（順序も固定）
  1. 攻撃
  2. 防御
  3. 特殊
  4. アイテム
  5. 戦況

### 1.3 サブ選択肢（5枠固定／不足は予備枠）
> α1.0では「5枠固定」を守る。項目が増える場合は「予備枠」→「ページング/Library検索（保留）」の順で拡張する。

#### 攻撃（Attack）
- **[確定]** 通常攻撃（近接／遠距離は武器で自動分岐）
- **[確定]** スキル攻撃
- **[確定]** 魔法（詠唱）
- **[補強]** 弾切替（AmmoSwap）  
  - 表示条件：**遠距離武器**かつ**弾種を2種以上保持**している場合のみ
- **[予備]** （空き）

#### 防御（Defense）
- **[確定]** ガード
- **[確定]** 回避
- **[確定]** パリィ（近接限定・条件付き）
- **[補強]** 防御補助（支援/回復）※「防御カテゴリに置くUI枠」として採用（実効果は魔法/スキル定義側）
- **[予備]** （空き）

#### 特殊（Special）
- **[確定]** 間合い（距離調整：詰める／取る）
- **[補強]** 観察（数値なしの“挙動タグ”提示：例「息が荒い」「足がもつれる」）
- **[補強]** 交渉／挑発／援護／指示（状況により出現）
- **[確定]** 撤退（扱いは戦闘裁定側に従う）
- **[補強]** 環境利用（崩落・遮蔽・高所など）

#### アイテム（Item）
- **[確定]** 使用
- **[確定]** 装備切替
- **[補強]** お気に入り（QuickUse）
- **[予備]** （空き）
- **[予備]** （空き）

#### 戦況（Situation）
- **[確定]** 距離
- **[確定]** 高低差
- **[確定]** 状態異常
- **[確定]** 残留効果
- **[補強]** AI提案（提案①〜③／補助④／シャッフル⑤）  
  ※UI上の“提案枠”として採用。提案内容はNoa裁定。

---

## 2. TimeCore（時間戦闘核）

### 2.1 時間単位
- **[確定]** 内部基本単位：**μt（マイクロティック）**
- **[補強]** 1 tick = 8 μt（推奨）  
  - プレイヤーにとっての体感は「秒」だが、内部はμtで精密に順序決定する

### 2.2 イベント駆動（Schedule → Execute）
- **[確定]** 行動はすべて「予約（Schedule）」され、予定時刻に「成立判定（Execute/Resolve）」が行われる。
- **[補強]** 先に成立した行動が、後続の予約行動に影響しうる（Delay / Fail / Cancel / Convert）。
- **[補強]** 完全同時刻（同μt）に命中判定が重なった場合、双方命中（相討ち）を許容する。

---

## 3. 行動モデル（Schedule → Execute）

### 3.1 行動フェーズ（Action Phases）
- **[確定]** Start → Resolve → Recover
- **[補強]** さらに詳細化する場合、以下を採用してよい（α1.0で有効）
  - Start（準備）
  - Move（移動：射程外なら自動接敵が発生しうる）
  - Resolve（命中・ダメージ等が確定する瞬間）
  - Recover（硬直）
  - Cooldown（再使用CD：行動固有）
  - Global Lock（入力硬直：システム共通の「間」）

### 3.2 主要データ（主要カラム例）
> 実装・データ化のための最小セット（名称はUnity実装で合わせる）

- **ActionIntent（予約データ）**
  - actorId
  - actionType（attack/defense/special/item）
  - executionModel（instant / chant / projectile など）
  - scheduleTime（μt）
  - snapshotPolicy（resolve時参照／発射時固定など）
  - targetPolicy（single/aoe/none）
  - tags（weaponType, element, stance, etc）
  - cost（fatigue等の内部コスト）
- **ActionResult（解決結果）**
  - resolvedTime（μt）
  - outcome（success/fail/partial）
  - effects（damage/status/knockback/timeShift 等のリスト）
  - logTokens（表示用の断片）

---

## 4. ステータス体系（情報二層）

### 4.1 Hardcore原則（UI非表示）
- **[確定]** HP/MP/命中率/残り時間などの“数値”はプレイヤーに見せない。
- **[補強]** 代わりに「観測文（描写）」や「挙動タグ」で提示する（観察・職業・熟練で精度が上がる）。

### 4.2 基礎能力値（Attributes）［補強→確定］
- 物理：STR / DEX / AGI / VIT
- 精神：INT / WIL / PER / CHA / LUK
- 拡張：SOUL / MEM  
  ※SOUL/MEMは世界観コア要素として保持する（α1.0でも内部保持可）

### 4.3 リソース（Resources）［補強→確定］
- HP / MP / ST（スタミナ） / Focus（集中） / Soul（魂力）

### 4.4 耐性（Resistances）［補強→確定］
- 物理：斬／打／突
- 属性：始原七翼（火・水・風・土・光・闇・（第七翼））
- 状態異常：毒／沈黙／恐怖…など

### 4.5 EraTier（時代格）［補強→確定］
- 呪術 ＞ 戦争 ＞ 古代 ＞ 始原  
  高位の時代格は下位の防御を貫通・無効化しうる（例外裁定用）

---

## 5. 距離・空間・移動

### 5.1 空間表現
- **[確定]** XYZセル管理
- **[確定]** 距離単位：0.1m または 0.5m（内部整数）
- **[補強]** 高低差を含めた3D直線距離を採用（ZLevel段階でも可）

### 5.2 近接・射程
- **[確定]** 近接：1.0m以内
- **[確定]** 射程：武器／魔法定義に依存

### 5.3 移動
- **[確定]** 移動はTimeCoreの一部として扱う（移動も行動であり時間を消費）
- **[補強]** 自動接敵（オートクローズ）：射程外で攻撃予約した場合、Moveフェーズで距離を詰めうる  
  ※「移動専念（速い）」と「攻撃接近（遅い）」で係数を分ける

---

## 6. 攻撃処理（近接／遠距離）

### 6.1 近接攻撃
- **[確定]** Start完了時点で近接範囲内ならResolveへ
- **[確定]** Resolve時点の距離で判定

### 6.2 遠距離攻撃
- **[確定]** 発射 → 飛翔 → 命中判定
- **[確定]** 対象が移動した場合は偏差判定

### 6.3 偏差射撃
- **[確定]** 熟練・DEX・HITにより自動判定（差分は内部処理）

---

## 7. 防御仕様（最重要・確定）

### 7.1 防御の原則
- **[確定] 防御は割り込み不可**
- **[確定] 必ず自分のターンで選択**する
- **[確定] 防御は「次の1回の被弾」にのみ有効**

### 7.2 ガード
- **[確定]** 被ダメージ軽減
- **[確定]** 成功度：Fail / Success / Just  
  - Justは確率判定（AGI・スキル・状況）

### 7.3 回避
- **[確定]** 命中判定を回避（AVD・AGI vs HIT・DEX）
- **[確定]** 移動を伴うため疲労が蓄積しやすい

### 7.4 パリィ
- **[確定]** 近接限定・条件付き
- **[確定]** 主効果：TimeShift（行動順有利）

---

## 8. 疲労（Fatigue）

- **[確定]** 回避・移動・重行動で蓄積
- **[確定]** 疲労が高いほど
  - 行動Startが遅れる
  - 回避成功率低下
- **[確定]** 疲労はTimeShiftとして表現

---

## 9. 部位・ゾーン

### 9.1 部位
- **[確定]** 頭部／胴体／腕／脚など
- **[確定]** 狙い指定は条件・熟練・自由記述

### 9.2 ゾーン影響
- **[確定]** 無防備・露出状態で部位異常発生率上昇

---

## 10. 状態異常（採用セット）

> v1.5の「…」を、NotebookLLMメモで補強し **α1.0採用セットとして確定**する。  
> 表示は数値ではなく観測文で行う。

- **[確定]** 出血（Bleed）
- **[確定]** 毒（Poison）
- **[確定]** 火傷（Burn）
- **[確定]** 凍結（Freeze）
- **[確定]** 感電（Shock）
- **[確定]** 恐怖（Fear）
- **[確定]** 沈黙（Silence）※自由記述入力が封印される（Hardcore演出）
- **[確定]** 眩暈／よろめき（Stun系：短時間のTimeShift/入力阻害として表現）

---

## 11. 魔法・詠唱

- **[確定]** 魔法は「詩（言葉）・構文（ルール）・魂（意志）」で成立する
- **[補強→確定]** 三層構造
  - 詩唱魔法（道具不要・即時）
  - 陣詠魔法（魔法陣必要・中範囲）
  - 詩構術式（素材・長時間・世界干渉）
- **[補強→確定]** 発現形式（Delivery）
  - 発現／飛翔（Projectile）／放射（Ray）／範囲（AoE）／フィールド／付与／召喚／変質／設置／連鎖
- **[補強→確定]** スナップショット
  - 射撃（ロック位置型）は「放った瞬間に狙点が固定」
- **[補強→確定]** 詠唱中断
  - 高位魔法ほど詠唱が長く、被弾で中断や暴走のリスク

---

## 12. 戦闘ログ（二層構造）

- **[補強→確定]** ログには二層がある
  1) **Noaの記録（正史）**：数値計算に基づいた正確な断片記録（ただし数値は伏せる）  
  2) **NPCの語り（伝承）**：誤解や誇張を含む不確かな物語（世界へ拡散する）
- **[補強→確定]** 研究ノート：プレイヤーが手書きで記録し、転生や世代を超えて攻略精度を上げる  
  ※システムは“自動攻略メモ”を作らない。ログ引用などの作業軽減のみ許可。

---

## 13. AIとナラティブ運用

- **[補強→確定]** 観測解像度：職業・熟練により提示情報が具体化する（例：医療、ハンター、鑑定）
- **[補強→確定]** 敵AI：最適解固定ではなく、疲労・状態・距離に応じた判断の揺らぎを持つ
- **[確定]** 「語り→顕現」原則により、戦闘中の状況提示はログと観測文が主役

---

## 14. 禁止事項（事故防止）

- **[確定]** BackをRoot 5枠に置かない
- **[確定]** HP/MP/命中率/残り秒などの“数値UI表示”をしない
- **[確定]** Resolving中に新しい行動入力を許可しない（防御も例外なし）
- **[確定]** 「割り込み防御」は存在しない（今後も採用しない）

---

## 15. テストチェックリスト（α1.0）

1. Rootが常に5枠で崩れない（攻撃/防御/特殊/アイテム/戦況）
2. BackがActionBoardに紛れない（Esc/Bで戻れる）
3. Commit後に入力ロックが入る（Root/サブが押せない）
4. Resolving中はログ主導で進行する（背景クリックで次ログ／AutoAdvanceで放置進行）
5. Resolving中に防御が押せない（割り込み不可）
6. 近接：Resolve時点距離で当たる／遠距離：飛翔＋偏差
7. 回避・移動で疲労が増え、TimeShiftが乗る
8. 状態異常（毒/恐怖/沈黙等）が観測文として出る（数値は出ない）
9. LogHistoryOverlay中は進行が止まる
10. FreeInputはIME変換中に送信されない

---

## 16. 更新履歴
- 2026-01-10 / ノア / v1.6 作成：v1.5を正として矛盾解消、NotebookLLM整理メモを補強採用（状態異常・二層ログ・QuickUse/AmmoSwap等）
